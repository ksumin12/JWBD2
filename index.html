<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>è‡ªç”±ä¸–ç•Œ</title>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html, body { height: 100%; }

    body{
      margin: 0;
      background: #f2f2f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      overflow: hidden;
    
      /* âœ… iOSì—ì„œ 100% ëŒ€ì‹  â€œì‹¤ì œ ë³´ì´ëŠ” ë†’ì´â€ ì‚¬ìš© */
      height: calc(var(--vh, 1vh) * 100);
    }
    .chat-app{
      display: none;
      max-width: 520px;
      margin: 0 auto;
      background: #f2f2f7;
    
      /* âœ… ë ˆì´ì•„ì›ƒì„ flex columnìœ¼ë¡œ */
      height: calc(var(--vh, 1vh) * 100);
      display: none;            /* ê¸°ì¡´ ìœ ì§€ */
      flex-direction: column;   /* âœ… ì¶”ê°€ */
    }


    /* Intro */
    #intro {
      position: fixed;
      inset: 0;
      background-color: #f2f2f7;
      color: #444;
      font-size: 14px;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      text-align: center;
      animation: pop 1.5s infinite ease-in-out;
      z-index: 10;
      white-space: pre-line;
      line-height: 1.8;
    }
    @keyframes pop {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Chat Layout (iMessage style) */

    .chat-header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: sticky;
      top: 0;
      z-index: 5;
      background: rgba(242, 242, 247, 0.88);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,0.06);
      padding-top: env(safe-area-inset-top);
      height: calc(56px + env(safe-area-inset-top));
    }

    .chat-header .title {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      line-height: 1.1;
    }
    .chat-header .title .name {
      font-size: 14px;
      font-weight: 600;
      color: #111;
    }
    .chat-header .title .status {
      font-size: 11px;
      color: rgba(0,0,0,0.5);
    }

    .message-list{
      /* âœ… ê¸°ì¡´ height: calc(...) ì œê±° */
      flex: 1;
      overflow-y: auto;
      padding: 14px 12px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    
      /* âœ… ì…ë ¥ì°½ + í•˜ë‹¨ safe-area ë§Œí¼ ë°‘ ì—¬ë°± í™•ë³´ */
      padding-bottom: calc(18px + 70px + env(safe-area-inset-bottom));
    }

    .day-sep {
      align-self: center;
      font-size: 11px;
      color: rgba(0,0,0,0.45);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(0,0,0,0.06);
      margin: 4px 0 8px;
    }

    .row {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      max-width: 100%;
    }
    .row.me { justify-content: flex-end; }
    .row.other { justify-content: flex-start; }

    .avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      flex: 0 0 28px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .bubble {
      max-width: min(78%, 380px);
      padding: 10px 12px;
      border-radius: 18px;
      font-size: 13px;
      line-height: 1.35;
      word-wrap: break-word;
      white-space: pre-wrap;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }

    /* iMessage ìƒ‰ê° */
    .bubble.me {
      background: #0b93f6; /* iMessage blue */
      color: #fff;
      border-bottom-right-radius: 6px;
    }
    .bubble.other {
      background: #e5e5ea; /* iMessage gray */
      color: #111;
      border-bottom-left-radius: 6px;
    }

    .subtext {
      margin-top: 6px;
      font-size: 12px;
      opacity: 0.75;
    }
    .bubble.me .subtext { opacity: 0.85; }

    .meta {
      font-size: 10px;
      color: rgba(0,0,0,0.35);
      margin: 0 6px;
      user-select: none;
    }
    .row.me .meta { text-align: right; }

    /* Typing indicator */
    .typing {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 10px 12px;
      border-radius: 18px;
      background: #e5e5ea;
      border-bottom-left-radius: 6px;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      animation: bounce 1s infinite ease-in-out;
    }
    .dot:nth-child(2) { animation-delay: 0.12s; }
    .dot:nth-child(3) { animation-delay: 0.24s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: translateY(0); opacity: 0.5; }
      40% { transform: translateY(-4px); opacity: 1; }
    }

    /* Input bar */
    .chat-input {
      height: 70px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-top: 1px solid rgba(0,0,0,0.06);
      background: rgba(242, 242, 247, 0.92);
      backdrop-filter: blur(10px);
      padding-bottom: calc(10px + env(safe-area-inset-bottom));
    }

    .chat-input .field {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 22px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }

    .chat-input input {
      border: none;
      outline: none;
      width: 100%;
      font-size: 13px;
      background: transparent;
    }

    .send-btn {
      border: none;
      background: #0b93f6;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      padding: 10px 14px;
      border-radius: 18px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(11,147,246,0.22);
    }
    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    @media (max-width: 480px) {
      #intro { font-size: 11px; padding: 30px 20px; }
      .bubble { font-size: 12.5px; }
      .chat-app { max-width: 100%; }
    }
  </style>
</head>

<body>
  <div id="intro">
    ë‹ˆì½œë¼ìŠ¤ì—ê²Œ ìƒì¼ ì¶•í•˜ ë©”ì„¸ì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!
    ì–´ì©Œë©´ ì²œì‚¬ì˜ ë‹µì¥ì„ ë°›ì„ ìˆ˜ë„?
    è‡ªç”±ä¸–ç•Œ, ì§€ê¸ˆ ì ‘ì† ì¤‘ ...
  </div>

  <div class="chat-app" id="chatApp">
    <div class="chat-header">
      <div class="title">
        <div class="name">è‡ªç”±ä¸–ç•Œ</div>
        <div class="status"> ì¬ì›Œë‹ˆğŸ©µ </div>
      </div>
    </div>

    <div class="message-list" id="messageList">
      <div class="day-sep" id="daySep"></div>
    </div>

    <form class="chat-input" id="chatForm" autocomplete="off">
      <div class="field">
        <input type="text" id="message" placeholder="iMessageâ€¦" required />
      </div>
      <button type="submit" class="send-btn" id="sendBtn" disabled>â†‘</button>
    </form>
  </div>

  <script>
        const TRIGGERS = [
      {
        // âœ… ë‹¨ì–´ A (ì—¬ê¸° ë¬¸ìì—´ì„ ì‹¤ì œ í‚¤ì›Œë“œë¡œ ë°”ê¿”ì¤˜)
        keywords: ["ì¶•í•˜"],
        replies: [
          "ì§„ì§œ ì§„ì§œ ì¶•í•˜í•´ì¤˜ì„œ ê³ ë§ˆì›Œ ì˜¤ëŠ˜ ğŸ¥¹",
          "ë•ë¶„ì— í–‰ë³µí•œ ìƒì¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•´ì¤˜ì„œ ê³ ë§ˆì›Œìš”ğŸ«¶ğŸ»",
          "ë¬´ì—‡ë³´ë‹¤ ëŠ˜ ê°™ì€ ìë¦¬ì—ì„œ ì‘ì›í•´ì¤˜ì„œ ê³ ë§ˆì›Œ ã… ã… ã…  ì‚¬ë‘í•´ ğŸ«¶ğŸ»"
        ],
        bag: []
      },
      {
        // âœ… ë‹¨ì–´ B (ì—¬ê¸° ë¬¸ìì—´ì„ ì‹¤ì œ í‚¤ì›Œë“œë¡œ ë°”ê¿”ì¤˜)
        keywords: ["ì‚¬ë‘"],
        replies: [
          "ì‚¬ë‘í•´ ë‚˜ë„ ì–¸ì œê¹Œì§€ë‚˜ ë„ˆ í¸ì´ ë˜ì–´ì¤„ê²Œ",
          "ëŠ˜ ì‚¬ë‘í•´ìš”. ëŠ˜ ê³ì— ìˆì„ê²Œìš”.",
          "ëŠ˜ ë‚´ê°€ ì‘ì›í•˜ê³  ëŠ˜ ë‚´ê°€ ë§ì´ ì¢‹ì•„í•´ ì‚¬ë‘í•´ â™¥ï¸",
          "ë§ˆìŒ í‘œí˜„í•´ì¤˜ì„œ ê³ ë§ˆì›Œ ì‚¬ë‘í•´ ğŸ©µğŸ’™"
        ],
        bag: []
      }
    ];
    function setVh() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVh();
    window.addEventListener('resize', setVh);
    window.addEventListener('orientationchange', setVh);


    // 3ì´ˆ í›„ ì˜¤í”„ë‹ ìˆ¨ê¸°ê³  ë³¸ë¬¸ í‘œì‹œ
    window.onload = () => {
      setTimeout(() => {
        document.getElementById("intro").style.display = "none";
        document.getElementById("chatApp").style.display = "block";
        setDaySeparator();
        scrollToBottom();
      }, 3000);
    };

    const chatForm = document.getElementById("chatForm");
    const messageList = document.getElementById("messageList");
    const input = document.getElementById("message");
    const sendBtn = document.getElementById("sendBtn");
    const daySep = document.getElementById("daySep");

        function updateSendBtn() {
          sendBtn.disabled = input.value.trim().length === 0;
        }
        
        updateSendBtn();
        input.addEventListener("input", updateSendBtn);
        input.addEventListener("keyup", updateSendBtn);
        input.addEventListener("compositionend", updateSendBtn);

        
        // ë°°ì—´ ì…”í”Œ
        function shuffle(arr) {
          return [...arr].sort(() => Math.random() - 0.5);
        }
        
        // íŠ¸ë¦¬ê±° bag ë¦¬í•„ (ì—°ì† ì¤‘ë³µ ì¤„ì´ê¸°)
        function refillTriggerBag(trigger) {
          trigger.bag = shuffle(trigger.replies);
        }
        
        // ì…ë ¥ í…ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ë˜ëŠ” íŠ¸ë¦¬ê±° ì°¾ê¸° (ìœ„ì— ìˆëŠ” íŠ¸ë¦¬ê±° ìš°ì„ )
        function findTrigger(text) {
          const t = text.toLowerCase();
          return TRIGGERS.find(tr =>
            tr.keywords.some(k => t.includes(String(k).toLowerCase()))
          ) || null;
        }
        
        // íŠ¸ë¦¬ê±°ì— í•´ë‹¹í•˜ëŠ” ëœë¤ ë‹µì¥ 1ê°œ ë½‘ê¸°
        function drawReply(trigger) {
          if (!trigger.bag || trigger.bag.length === 0) refillTriggerBag(trigger);
          return trigger.bag.pop();
        }
        
        // ë‚ ì§œ êµ¬ë¶„ì„  ì„¸íŒ…
        function setDaySeparator() {
          const now = new Date();
          const yy = now.getFullYear();
          const mm = String(now.getMonth() + 1).padStart(2, "0");
          const dd = String(now.getDate()).padStart(2, "0");
          daySep.textContent = `${yy}.${mm}.${dd}`;
        }
        
        // ì‹œê°„ í¬ë§· (ì˜¤ì „/ì˜¤í›„)
        function formatTime(date) {
          const h = date.getHours();
          const m = String(date.getMinutes()).padStart(2, "0");
          const ampm = h < 12 ? "ì˜¤ì „" : "ì˜¤í›„";
          const hh = (h % 12) === 0 ? 12 : (h % 12);
          return `${ampm} ${hh}:${m}`;
        }
        
        // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
        function scrollToBottom() {
          messageList.scrollTop = messageList.scrollHeight;
        }
        
        // ë‚´ ë©”ì‹œì§€ ì¶”ê°€
        function addMyMessage(text) {
          const row = document.createElement("div");
          row.className = "row me";
        
          const bubble = document.createElement("div");
          bubble.className = "bubble me";
          bubble.textContent = text;
        
          const meta = document.createElement("div");
          meta.className = "meta";
          meta.textContent = formatTime(new Date());
        
          row.appendChild(meta);
          row.appendChild(bubble);
          messageList.appendChild(row);
          scrollToBottom();
        }
        
        // ë‹ˆì½œë¼ìŠ¤ ë©”ì‹œì§€ ì¶”ê°€ (í•œê¸€ë§Œ)
        function addJWMessage(replyText) {
          const row = document.createElement("div");
          row.className = "row other";
        
          const avatar = document.createElement("div");
          avatar.className = "avatar";
          avatar.innerHTML = `<img src="https://i.imgur.com/Cudzc0A.jpeg" alt="Nicholas">`;
        
          const bubble = document.createElement("div");
          bubble.className = "bubble other";
          bubble.textContent = replyText;
        
          row.appendChild(avatar);
          row.appendChild(bubble);
          messageList.appendChild(row);
          scrollToBottom();
        }
        
        // íƒ€ì´í•‘ í‘œì‹œ
        let typingEl = null;
        
        function showTyping() {
          const row = document.createElement("div");
          row.className = "row other";
        
          const avatar = document.createElement("div");
          avatar.className = "avatar";
          avatar.innerHTML = `<img src="https://i.imgur.com/Cudzc0A.jpeg" alt="Nicholas">`;
        
          const typing = document.createElement("div");
          typing.className = "typing";
          typing.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
        
          row.appendChild(avatar);
          row.appendChild(typing);
          messageList.appendChild(row);
        
          typingEl = row;
          scrollToBottom();
        }
        
        function hideTyping() {
          if (typingEl) typingEl.remove();
          typingEl = null;
        }
        // âœ… (ì„ íƒ) ì²˜ìŒë¶€í„° ê° íŠ¸ë¦¬ê±° bag í•œ ë²ˆ ì„ì–´ë‘ê³  ì‹¶ìœ¼ë©´
        TRIGGERS.forEach(refillTriggerBag);
        
        // âœ… ì „ì†¡ ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
        sendBtn.disabled = input.value.trim().length === 0;
        
        input.addEventListener("input", () => {
          sendBtn.disabled = input.value.trim().length === 0;
        });
        
        // âœ… ì „ì†¡(Submit) ì´ë²¤íŠ¸
        chatForm.addEventListener("submit", (e) => {
          e.preventDefault();
        
          const text = input.value.trim();
          if (!text) return;
        
          // ë‚´ ë©”ì‹œì§€ ì¶”ê°€
          addMyMessage(text);
        
          // íŠ¸ë¦¬ê±° í¬í•¨ ì‹œ ëœë¤ ë‹µì¥
          const trigger = findTrigger(text);
          if (trigger) {
            showTyping();
            setTimeout(() => {
              hideTyping();
              addJWMessage(drawReply(trigger)); // í•œê¸€ ë‹µì¥ë§Œ
            }, 900);
          }
        

        });


    </script>
</body>
</html>
